<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx | 在路上</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/logo.png">
    <mata name="author" content="在路上"></mata>
    <mata name="Keyword" content="我的博客"></mata>
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="Nginx">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.5bae31cc.css" as="style"><link rel="preload" href="/assets/js/app.9f94fa3e.js" as="script"><link rel="preload" href="/assets/js/2.8154945c.js" as="script"><link rel="preload" href="/assets/js/12.f4be0313.js" as="script"><link rel="preload" href="/assets/js/3.4234061e.js" as="script"><link rel="prefetch" href="/assets/js/10.b0ef5cc7.js"><link rel="prefetch" href="/assets/js/100.c94e731e.js"><link rel="prefetch" href="/assets/js/101.48c30368.js"><link rel="prefetch" href="/assets/js/102.46c7e4c5.js"><link rel="prefetch" href="/assets/js/103.c3a5deff.js"><link rel="prefetch" href="/assets/js/104.0a230598.js"><link rel="prefetch" href="/assets/js/105.5bb8ca11.js"><link rel="prefetch" href="/assets/js/106.452ae601.js"><link rel="prefetch" href="/assets/js/107.25f200d5.js"><link rel="prefetch" href="/assets/js/108.17d74b6e.js"><link rel="prefetch" href="/assets/js/109.1609e827.js"><link rel="prefetch" href="/assets/js/11.97d54b7d.js"><link rel="prefetch" href="/assets/js/110.8ce06d9e.js"><link rel="prefetch" href="/assets/js/111.b852821d.js"><link rel="prefetch" href="/assets/js/112.5652e068.js"><link rel="prefetch" href="/assets/js/113.accd65c3.js"><link rel="prefetch" href="/assets/js/13.b65e9a3d.js"><link rel="prefetch" href="/assets/js/14.c144247d.js"><link rel="prefetch" href="/assets/js/15.22d5a186.js"><link rel="prefetch" href="/assets/js/16.c39f8058.js"><link rel="prefetch" href="/assets/js/17.ac8b7a7e.js"><link rel="prefetch" href="/assets/js/18.d5c9d2d1.js"><link rel="prefetch" href="/assets/js/19.f7cb55d0.js"><link rel="prefetch" href="/assets/js/20.1cc30f6c.js"><link rel="prefetch" href="/assets/js/21.52403b8d.js"><link rel="prefetch" href="/assets/js/22.00378f70.js"><link rel="prefetch" href="/assets/js/23.d9c0ec0b.js"><link rel="prefetch" href="/assets/js/24.12e60ed2.js"><link rel="prefetch" href="/assets/js/25.da452d33.js"><link rel="prefetch" href="/assets/js/26.1179da7d.js"><link rel="prefetch" href="/assets/js/27.62f142d7.js"><link rel="prefetch" href="/assets/js/28.4351295c.js"><link rel="prefetch" href="/assets/js/29.8bb6a22b.js"><link rel="prefetch" href="/assets/js/30.94188915.js"><link rel="prefetch" href="/assets/js/31.e1ea5f16.js"><link rel="prefetch" href="/assets/js/32.0efe0b9d.js"><link rel="prefetch" href="/assets/js/33.6786ff5b.js"><link rel="prefetch" href="/assets/js/34.4db9faa1.js"><link rel="prefetch" href="/assets/js/35.3c13aa80.js"><link rel="prefetch" href="/assets/js/36.4a436d94.js"><link rel="prefetch" href="/assets/js/37.c22727fa.js"><link rel="prefetch" href="/assets/js/38.47290810.js"><link rel="prefetch" href="/assets/js/39.2ef9d394.js"><link rel="prefetch" href="/assets/js/4.29fa54b8.js"><link rel="prefetch" href="/assets/js/40.a1a50e67.js"><link rel="prefetch" href="/assets/js/41.82a44a96.js"><link rel="prefetch" href="/assets/js/42.a86ea924.js"><link rel="prefetch" href="/assets/js/43.a7626ca2.js"><link rel="prefetch" href="/assets/js/44.1229cec8.js"><link rel="prefetch" href="/assets/js/45.c5dd3e94.js"><link rel="prefetch" href="/assets/js/46.0835e964.js"><link rel="prefetch" href="/assets/js/47.485ccf84.js"><link rel="prefetch" href="/assets/js/48.14084039.js"><link rel="prefetch" href="/assets/js/49.24165fa3.js"><link rel="prefetch" href="/assets/js/5.0e72a8e9.js"><link rel="prefetch" href="/assets/js/50.b5dae0a8.js"><link rel="prefetch" href="/assets/js/51.5ea88576.js"><link rel="prefetch" href="/assets/js/52.fa6a7f86.js"><link rel="prefetch" href="/assets/js/53.7ad7b4a8.js"><link rel="prefetch" href="/assets/js/54.0c093768.js"><link rel="prefetch" href="/assets/js/55.1fbbd65d.js"><link rel="prefetch" href="/assets/js/56.843ea8ee.js"><link rel="prefetch" href="/assets/js/57.123e346c.js"><link rel="prefetch" href="/assets/js/58.d34951c6.js"><link rel="prefetch" href="/assets/js/59.b85cf23f.js"><link rel="prefetch" href="/assets/js/6.d3ecc9b3.js"><link rel="prefetch" href="/assets/js/60.e9071331.js"><link rel="prefetch" href="/assets/js/61.6ac666dd.js"><link rel="prefetch" href="/assets/js/62.2b73a516.js"><link rel="prefetch" href="/assets/js/63.2d005674.js"><link rel="prefetch" href="/assets/js/64.3aa0f64f.js"><link rel="prefetch" href="/assets/js/65.61af7324.js"><link rel="prefetch" href="/assets/js/66.a8b4c0fa.js"><link rel="prefetch" href="/assets/js/67.4874cd0c.js"><link rel="prefetch" href="/assets/js/68.eb0fe894.js"><link rel="prefetch" href="/assets/js/69.d3da1271.js"><link rel="prefetch" href="/assets/js/7.3b12d94c.js"><link rel="prefetch" href="/assets/js/70.cb5a6540.js"><link rel="prefetch" href="/assets/js/71.97062bc7.js"><link rel="prefetch" href="/assets/js/72.3ace4280.js"><link rel="prefetch" href="/assets/js/73.5964117d.js"><link rel="prefetch" href="/assets/js/74.3a6f1e44.js"><link rel="prefetch" href="/assets/js/75.56bbe243.js"><link rel="prefetch" href="/assets/js/76.bdeb56a2.js"><link rel="prefetch" href="/assets/js/77.fc672f1c.js"><link rel="prefetch" href="/assets/js/78.62390d6f.js"><link rel="prefetch" href="/assets/js/79.e8590d7e.js"><link rel="prefetch" href="/assets/js/8.b4a14e8c.js"><link rel="prefetch" href="/assets/js/80.0649d97d.js"><link rel="prefetch" href="/assets/js/81.f54b68cd.js"><link rel="prefetch" href="/assets/js/82.a4f85774.js"><link rel="prefetch" href="/assets/js/83.abd156a5.js"><link rel="prefetch" href="/assets/js/84.0ba27a18.js"><link rel="prefetch" href="/assets/js/85.b84ccd9c.js"><link rel="prefetch" href="/assets/js/86.c46352c6.js"><link rel="prefetch" href="/assets/js/87.3291a1b3.js"><link rel="prefetch" href="/assets/js/88.67e95dba.js"><link rel="prefetch" href="/assets/js/89.83038095.js"><link rel="prefetch" href="/assets/js/9.82925584.js"><link rel="prefetch" href="/assets/js/90.fa92de62.js"><link rel="prefetch" href="/assets/js/91.a0a26338.js"><link rel="prefetch" href="/assets/js/92.5675720d.js"><link rel="prefetch" href="/assets/js/93.0bd5bc0c.js"><link rel="prefetch" href="/assets/js/94.843c0392.js"><link rel="prefetch" href="/assets/js/95.03e309fc.js"><link rel="prefetch" href="/assets/js/96.4faf8dc5.js"><link rel="prefetch" href="/assets/js/97.ca35ccb2.js"><link rel="prefetch" href="/assets/js/98.14c1848c.js"><link rel="prefetch" href="/assets/js/99.1f1b02fe.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5bae31cc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="在路上" class="logo"> <span class="site-name can-hide">在路上</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Spring
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/" class="nav-link">
  Home
</a></li><li class="dropdown-subitem"><a href="/about/" class="nav-link">
  About
</a></li></ul></li><li class="dropdown-item"><h4>
          Mybatis
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/" class="nav-link">
  Home
</a></li><li class="dropdown-subitem"><a href="/about/" class="nav-link">
  About
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="系统" class="dropdown-title"><span class="title">系统</span> <span class="arrow down"></span></button> <button type="button" aria-label="系统" class="mobile-dropdown-title"><span class="title">系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/os/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/os/ubuntu/" class="nav-link">
  Ubuntu
</a></li><li class="dropdown-item"><!----> <a href="/os/centos/" class="nav-link">
  CentOS
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/backend/nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/backend/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/backend/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/backend/docker/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          服务器
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Middleware/Nginx/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Nginx
</a></li></ul></li><li class="dropdown-item"><h4>
          消息队列
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/RabbitMQ/" class="nav-link">
  RabbitMQ
</a></li><li class="dropdown-subitem"><a href="/RocketMQ/" class="nav-link">
  RocketMQ
</a></li></ul></li><li class="dropdown-item"><h4>
          搜索引擎
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ElasticSearch/" class="nav-link">
  ElasticSearch
</a></li><li class="dropdown-subitem"><a href="/slor/" class="nav-link">
  Solr
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="OCR" class="dropdown-title"><span class="title">OCR</span> <span class="arrow down"></span></button> <button type="button" aria-label="OCR" class="mobile-dropdown-title"><span class="title">OCR</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          训练
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/OCR/train/" class="nav-link">
  模型训练
</a></li></ul></li><li class="dropdown-item"><h4>
          部署
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/OCR/deploy/hubserving/" class="nav-link">
  HubServing方式部署
</a></li><li class="dropdown-subitem"><a href="/OCR/deploy/paddleserving/" class="nav-link">
  PaddleServing方式部署
</a></li></ul></li><li class="dropdown-item"><h4>
          环境安装
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ElasticSearch/" class="nav-link">
  安装Cuda和Cudnn
</a></li><li class="dropdown-subitem"><a href="/slor/" class="nav-link">
  Solr
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><span class="title">开发工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发工具" class="mobile-dropdown-title"><span class="title">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/tools/github/" class="nav-link">
  Github
</a></li><li class="dropdown-item"><!----> <a href="/tools/vscode/" class="nav-link">
  VSCode
</a></li><li class="dropdown-item"><!----> <a href="/tools/bookmark-scripts/" class="nav-link">
  Bookmark scripts
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><span class="title">更多</span> <span class="arrow down"></span></button> <button type="button" aria-label="更多" class="mobile-dropdown-title"><span class="title">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/more/navigation.html" class="nav-link">
  导航 🎉
</a></li><li class="dropdown-item"><!----> <a href="https://shanyuhai123.github.io/vuepress-plugin-auto-sidebar/zh/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress 侧边栏插件
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://vuepress.vuejs.org/zh/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress 官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Spring
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/" class="nav-link">
  Home
</a></li><li class="dropdown-subitem"><a href="/about/" class="nav-link">
  About
</a></li></ul></li><li class="dropdown-item"><h4>
          Mybatis
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/" class="nav-link">
  Home
</a></li><li class="dropdown-subitem"><a href="/about/" class="nav-link">
  About
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="系统" class="dropdown-title"><span class="title">系统</span> <span class="arrow down"></span></button> <button type="button" aria-label="系统" class="mobile-dropdown-title"><span class="title">系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/os/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/os/ubuntu/" class="nav-link">
  Ubuntu
</a></li><li class="dropdown-item"><!----> <a href="/os/centos/" class="nav-link">
  CentOS
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/backend/nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/backend/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/backend/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/backend/docker/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          服务器
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Middleware/Nginx/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Nginx
</a></li></ul></li><li class="dropdown-item"><h4>
          消息队列
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/RabbitMQ/" class="nav-link">
  RabbitMQ
</a></li><li class="dropdown-subitem"><a href="/RocketMQ/" class="nav-link">
  RocketMQ
</a></li></ul></li><li class="dropdown-item"><h4>
          搜索引擎
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ElasticSearch/" class="nav-link">
  ElasticSearch
</a></li><li class="dropdown-subitem"><a href="/slor/" class="nav-link">
  Solr
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="OCR" class="dropdown-title"><span class="title">OCR</span> <span class="arrow down"></span></button> <button type="button" aria-label="OCR" class="mobile-dropdown-title"><span class="title">OCR</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          训练
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/OCR/train/" class="nav-link">
  模型训练
</a></li></ul></li><li class="dropdown-item"><h4>
          部署
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/OCR/deploy/hubserving/" class="nav-link">
  HubServing方式部署
</a></li><li class="dropdown-subitem"><a href="/OCR/deploy/paddleserving/" class="nav-link">
  PaddleServing方式部署
</a></li></ul></li><li class="dropdown-item"><h4>
          环境安装
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ElasticSearch/" class="nav-link">
  安装Cuda和Cudnn
</a></li><li class="dropdown-subitem"><a href="/slor/" class="nav-link">
  Solr
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><span class="title">开发工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发工具" class="mobile-dropdown-title"><span class="title">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/tools/github/" class="nav-link">
  Github
</a></li><li class="dropdown-item"><!----> <a href="/tools/vscode/" class="nav-link">
  VSCode
</a></li><li class="dropdown-item"><!----> <a href="/tools/bookmark-scripts/" class="nav-link">
  Bookmark scripts
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><span class="title">更多</span> <span class="arrow down"></span></button> <button type="button" aria-label="更多" class="mobile-dropdown-title"><span class="title">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/more/navigation.html" class="nav-link">
  导航 🎉
</a></li><li class="dropdown-item"><!----> <a href="https://shanyuhai123.github.io/vuepress-plugin-auto-sidebar/zh/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress 侧边栏插件
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://vuepress.vuejs.org/zh/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress 官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Nginx</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Middleware/Nginx/" aria-current="page" class="active sidebar-link">Nginx</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Middleware/Nginx/#前提准备" class="sidebar-link">前提准备</a></li><li class="sidebar-sub-header"><a href="/Middleware/Nginx/#nginx介绍" class="sidebar-link">Nginx介绍</a></li><li class="sidebar-sub-header"><a href="/Middleware/Nginx/#nginx安装" class="sidebar-link">Nginx安装</a></li><li class="sidebar-sub-header"><a href="/Middleware/Nginx/#nginx-目录" class="sidebar-link">Nginx 目录</a></li><li class="sidebar-sub-header"><a href="/Middleware/Nginx/#基本运行原理" class="sidebar-link">基本运行原理</a></li><li class="sidebar-sub-header"><a href="/Middleware/Nginx/#nginx配置" class="sidebar-link">Nginx配置</a></li><li class="sidebar-sub-header"><a href="/Middleware/Nginx/#反向代理与负载均衡" class="sidebar-link">反向代理与负载均衡</a></li><li class="sidebar-sub-header"><a href="/Middleware/Nginx/#动静分离" class="sidebar-link">动静分离</a></li><li class="sidebar-sub-header"><a href="/Middleware/Nginx/#url重写-urlrewrite" class="sidebar-link">URL重写（URLRewrite）</a></li><li class="sidebar-sub-header"><a href="/Middleware/Nginx/#负载均衡-urlrewirte" class="sidebar-link">负载均衡+URLRewirte</a></li></ul></li><li><a href="/Middleware/Nginx/configuration.html" class="sidebar-link">Nginx配置</a></li><li><a href="/Middleware/Nginx/install.html" class="sidebar-link">Nginx安装</a></li><li><a href="/Middleware/Nginx/introduce.html" class="sidebar-link">Nginx介绍</a></li><li><a href="/Middleware/Nginx/pre.html" class="sidebar-link">前提准备</a></li><li><a href="/Middleware/Nginx/principle.html" class="sidebar-link">基本运行原理</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="nginx"><a href="#nginx" class="header-anchor">#</a> Nginx</h1> <p><img src="https://minboo-blog-img.oss-cn-guangzhou.aliyuncs.com/img/image-20220910174009085.png" alt="image-20220910174009085"></p> <h2 id="前提准备"><a href="#前提准备" class="header-anchor">#</a> 前提准备</h2> <h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <p>注意：安装虚拟机是为了在本地虚拟化Linux环境，便于学习。对应了实际应用场景中，企业的云服务器</p> <ul><li><p>本地安装虚拟机Vmware、Virtualbox、Parallls</p> <p>有云服务器也可在服务器上操作</p> <p>本次使用Vmware16，软件安装过程省略</p></li> <li><p>系统CentOS 7</p> <p><a href="https://www.centos.org/download/" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>下载适合自己的版本</p> <p><img src="https://minboo-blog-img.oss-cn-guangzhou.aliyuncs.com/img/image-20220910151913324.png" alt="image-20220910151913324">
可随意选择一个镜像站下载
<img src="https://minboo-blog-img.oss-cn-guangzhou.aliyuncs.com/img/image-20220910152123490.png" alt="image-20220910152123490"></p> <p><img src="https://minboo-blog-img.oss-cn-guangzhou.aliyuncs.com/img/image-20220910152405332.png" alt="image-20220910152405332"></p> <table><thead><tr><th>版本</th> <th>说明</th></tr></thead> <tbody><tr><td>DVD ISO</td> <td>标准安装版</td></tr> <tr><td>Everything ISO</td> <td>对完整版安装盘的软件进行补充，集成所有软件。(包含<a href="https://so.csdn.net/so/search?q=centos7&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">centos7<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的一套完整的软件包，可以用来安装系统或者填充本地镜像)</td></tr> <tr><td>Minimal ISO</td> <td>精简版，自带的软件最少</td></tr> <tr><td>NetInstall ISO</td> <td>网络安装镜像(从网络安装或者救援系统)</td></tr></tbody></table></li> <li><p>在虚拟机中安装CentOS镜像，安装步骤省略</p> <p><img src="https://minboo-blog-img.oss-cn-guangzhou.aliyuncs.com/img/image-20220910153032582.png" alt="image-20220910153032582"></p> <p>安装成功后重启系统登录</p> <p><img src="https://minboo-blog-img.oss-cn-guangzhou.aliyuncs.com/img/image-20220910154037280.png" alt="image-20220910154037280"></p> <img src="https://minboo-blog-img.oss-cn-guangzhou.aliyuncs.com/img/image-20220910154207899.png"></li></ul> <h3 id="配置虚拟机网络"><a href="#配置虚拟机网络" class="header-anchor">#</a> 配置虚拟机网络</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">ip</span> addr <span class="token comment">#查看网络</span>
</code></pre></div><p>可以看到两个网卡 <code>lo</code>和<code>ens33</code>（lo是本地网卡）</p> <p><img src="https://minboo-blog-img.oss-cn-guangzhou.aliyuncs.com/img/image-20220910154354632.png" alt="image-20220910154354632"></p> <p>使用vi编辑器打开<code>ens33</code>网络的配置文件，修改启动配置（如何使用vi编辑器：<code>i</code>修模式改数据，<code>esc</code>退出，<code>:wq</code>保存退出vi编辑器）</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">vi</span> /etc/sysconfig/network-scripts/ifcfg-ens33
</code></pre></div><p><img src="https://minboo-blog-img.oss-cn-guangzhou.aliyuncs.com/img/image-20220910154720589.png" alt="image-20220910154720589"></p> <p>重启网络</p> <div class="language-text extra-class"><pre class="language-text"><code>systemctl restart network
</code></pre></div><p>就能看到ens33被分配在了网络IP（192.168.75.136），但是这个网路是动态分配的内网地址，重启后会可能会变化。</p> <p><img src="https://minboo-blog-img.oss-cn-guangzhou.aliyuncs.com/img/image-20220910154905916.png" alt="image-20220910154905916"></p> <h3 id="克隆虚拟机"><a href="#克隆虚拟机" class="header-anchor">#</a> 克隆虚拟机</h3> <p>两种克隆方式，选择哪种都可以将前面配置的虚拟机克隆出来新的</p> <p><img src="https://minboo-blog-img.oss-cn-guangzhou.aliyuncs.com/img/image-20220910155137275.png" alt="image-20220910155137275"></p> <h3 id="使用ssh连接虚拟机"><a href="#使用ssh连接虚拟机" class="header-anchor">#</a> 使用SSH连接虚拟机</h3> <p>使用SSH可以方便的在本地连接远程云服务器（对应的就是我们这里装在本地的虚拟机），对其进行</p> <p>SSH软件很多，比如Xshell，他们的使用都大同小异，我这里使用的是Mac上的Termius，</p> <p><strong>新建连接</strong></p> <p><img src="https://minboo-blog-img.oss-cn-guangzhou.aliyuncs.com/img/image-20220910155322683.png" alt="image-20220910155322683"></p> <p>主机地址就是云服务器的公网地址，对应就是上面本地虚拟机ens33这个网卡的地址，与公网地址不同，这个地址是内网地址，每次重启都会动态分配，所以我们使用这个地址链接上</p> <p><img src="https://minboo-blog-img.oss-cn-guangzhou.aliyuncs.com/img/image-20220910155529771.png" alt="image-20220910155529771"></p> <p><strong>修改固定IP</strong></p> <p>这一步仅仅是因为，ens33这个网卡的地址，每次重启都会动态分配，所以我们使用这个地址每次都需要修改SSH工具的“主机名”，所以，我们改成固定的。（如果你使用的是云服务器，使用公网IP连接，这个公网IP是不会变化的，就不用这一步）</p> <p>还是进入ens33网卡的配置文件</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">vi</span> /etc/sysconfig/network-scripts/ifcfg-ens33
</code></pre></div><p><img src="https://minboo-blog-img.oss-cn-guangzhou.aliyuncs.com/img/image-20220910155943952.png" alt="image-20220910155943952"></p> <p>增加一下配置</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">192.168</span>.75.101 <span class="token comment"># 设置IP</span>
<span class="token assign-left variable">NETMASK</span><span class="token operator">=</span><span class="token number">225.225</span>.225.0 <span class="token comment">#子网掩码</span>
<span class="token assign-left variable">GATEWAY</span><span class="token operator">=</span><span class="token number">192.168</span>.75.2 <span class="token comment">#网关</span>
<span class="token assign-left variable">DNS1</span><span class="token operator">=</span><span class="token number">8.8</span>.8.8 <span class="token comment"># DNS服务器地址</span>
</code></pre></div><p>修改文件中BOOTPROTO字段为static后，后IP就固定为了IPADDR的值</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>static <span class="token comment">#原来值是dhcp，就是动态获取ip的一个协议</span>
</code></pre></div><h2 id="nginx介绍"><a href="#nginx介绍" class="header-anchor">#</a> Nginx介绍</h2> <div class="language- extra-class"><pre><code>- Nginx开源版 http://nginx.org/en/

  官方原始的Nginx版本

- Nginx plus商业版

  开箱即用，集成了大量功能

- Open Resty https://openresty.org/cn/

  OpenResty是一个基于Nginx与 Lua 的高性能 Web 平台，其内部集成了大量精良的 Lua 库、第三方模块以及大多数的依赖项。**更适用于需要大量二次开发的场景，有极强的扩展性**

- Tengine https://tengine.taobao.org/

  由淘宝网发起的Web服务器项目。它在[Nginx (opens new window)](http://nginx.org/)的基础上，针对大访问量网站的需求，添加了很多高级功能和特性。Tengine的性能和稳定性已经在大型的网站如[淘宝网 (opens new window)](http://www.taobao.com/)，[天猫商城 (opens new window)](http://www.tmall.com/)等得到了很好的检验。相比于Open Resty，扩展性不够强，但是能够满足绝多数使用场景
</code></pre></div><h2 id="nginx安装"><a href="#nginx安装" class="header-anchor">#</a> Nginx安装</h2> <ul><li><p><strong>下载Nginx包</strong></p> <p><a href="http://nginx.org/en/download.html" target="_blank" rel="noopener noreferrer">官网下载地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="https://minboo-blog-img.oss-cn-guangzhou.aliyuncs.com/img/image-20220910161044819.png" alt="image-20220910161044819"></p> <p>使用FTP工具将文件上传到虚拟机中</p> <ul><li><p>解压Nginx包，并安装</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">tar</span> <span class="token parameter variable">-zxvf</span>  nginx-1.23.1.tar.gz <span class="token comment">#解压到当前目录</span>

<span class="token builtin class-name">cd</span> nginx-1.23.1 <span class="token comment">#进入解压后的文件夹</span>
<span class="token function">ls</span> <span class="token comment">#文件夹中的文件：auto     CHANGES.ru  configure  html     man     src CHANGES  conf        contrib    LICENSE  README</span>
</code></pre></div><p>安装依赖库</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#安装C编译器</span>
yum <span class="token function">install</span> <span class="token parameter variable">-y</span> gcc

<span class="token comment">#安装pcre库</span>
yum <span class="token function">install</span> <span class="token parameter variable">-y</span> pcre pcre-devel

<span class="token comment">#安装zlib</span>
yum <span class="token function">install</span> <span class="token parameter variable">-y</span> zlib zlib-devel
</code></pre></div><p>安装</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> nginx-1.23.1
./configure <span class="token parameter variable">--prefix</span><span class="token operator">=</span>/usr/local/nginx <span class="token comment">#使用prefix选项指定安装的目录</span>
<span class="token function">make</span>
<span class="token function">make</span> <span class="token function">install</span>
</code></pre></div><p>启动</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /usr/local/nginx/sbin

<span class="token function">ls</span> <span class="token comment"># 里面是一个nginx的可执行文件</span>

./nginx <span class="token comment"># 启动这个可执行</span>
</code></pre></div><p><strong>关于防火墙</strong></p> <p>关闭防火墙</p> <div class="language-shell extra-class"><pre class="language-shell"><code>systemctl stop firewalld.service
</code></pre></div><p>禁止防火墙开机启动</p> <div class="language-shell extra-class"><pre class="language-shell"><code>systemctl disable firewalld.service 
</code></pre></div><p>放行端口</p> <div class="language-shell extra-class"><pre class="language-shell"><code>firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">80</span>/tcp <span class="token parameter variable">--permanent</span> 
</code></pre></div><p>重启防火墙</p> <div class="language-shell extra-class"><pre class="language-shell"><code>firewall-cmd <span class="token parameter variable">--reload</span>
systemctl restart firewalld
</code></pre></div><p><strong>补充Nginx命令</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>./nginx <span class="token parameter variable">-s</span> stop <span class="token comment">#快速停止</span>
./nginx <span class="token parameter variable">-s</span> quit <span class="token comment">#完成已接受的请求后，停止</span>
./nginx <span class="token parameter variable">-s</span> reload <span class="token comment">#重新加载配置</span>
./nginx <span class="token parameter variable">-t</span> <span class="token comment">#检查nginx配置是否正确</span>
</code></pre></div><p>查看nginx状态</p> <div class="language-text extra-class"><pre class="language-text"><code>ps -ef|grep nginx
</code></pre></div><p>启动时：</p> <p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Nginx/image-20220501205303265.png" alt="image-20220501205303265"></p> <p>停止时：</p> <p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Nginx/image-20220501205333304.png" alt="image-20220501205333304"></p></li> <li><p>注册系统服务</p> <p>通过系统服务的方式启动nginx</p> <div class="language-text extra-class"><pre class="language-text"><code>vi /usr/lib/systemd/system/nginx.service
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span> 
<span class="token assign-left variable">Description</span><span class="token operator">=</span>nginx
<span class="token assign-left variable">After</span><span class="token operator">=</span>network.target remote-fs.target nss-lookup.target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Type</span><span class="token operator">=</span>forking
<span class="token assign-left variable">PIDFile</span><span class="token operator">=</span>/usr/local/nginx/logs/nginx.pid
<span class="token assign-left variable">ExecStartPre</span><span class="token operator">=</span>/usr/local/nginx/sbin/nginx <span class="token parameter variable">-t</span> <span class="token parameter variable">-c</span> /usr/local/nginx/conf/nginx.conf
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/local/nginx/sbin/nginx <span class="token parameter variable">-c</span> /usr/local/nginx/conf/nginx.conf
<span class="token assign-left variable">ExecReload</span><span class="token operator">=</span>/usr/local/nginx/sbin/nginx <span class="token parameter variable">-s</span> reload
<span class="token assign-left variable">ExecStop</span><span class="token operator">=</span>/usr/local/nginx/sbin/nginx <span class="token parameter variable">-s</span> stop
<span class="token assign-left variable">ExecQuit</span><span class="token operator">=</span>/usr/local/nginx/sbin/nginx <span class="token parameter variable">-s</span> quit 
<span class="token assign-left variable">PrivateTmp</span><span class="token operator">=</span>true
   
<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>   
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target  <span class="token comment"># 多用户</span>
</code></pre></div><p>重新加载系统服务</p> <div class="language-shell extra-class"><pre class="language-shell"><code>systemctl daemon-reload
</code></pre></div><p>启动服务</p> <div class="language-shell extra-class"><pre class="language-shell"><code>systemctl start nginx.service 
</code></pre></div><p>开机启动</p> <div class="language-shell extra-class"><pre class="language-shell"><code>systemctl <span class="token builtin class-name">enable</span> nginx.service
</code></pre></div><p>配置软链接，以便全局使用nginx命令：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/local/nginx/sbin/nginx /usr/sbin/nginx
</code></pre></div></li></ul></li></ul> <h2 id="nginx-目录"><a href="#nginx-目录" class="header-anchor">#</a> Nginx 目录</h2> <p>进入Nginx的主目录我们可以看到这些文件夹</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost nginx<span class="token punctuation">]</span><span class="token comment"># ls</span>
client_body_temp  conf  fastcgi_temp  html  logs  proxy_temp  sbin  scgi_temp  uwsgi_temp
</code></pre></div><p>其中这几个文件夹在刚安装后是没有的，主要用来存放运行过程中的临时文件</p> <div class="language-shell extra-class"><pre class="language-shell"><code>client_body_temp fastcgi_temp proxy_temp scgi_temp
</code></pre></div><p><strong>conf</strong> 用来存放配置文件相关</p> <p><strong>html</strong> 用来存放静态文件的默认目录 html、css等</p> <p><strong>sbin</strong> nginx的主程序</p> <p><strong>logs</strong> 文件夹用于存放日志信息</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># tree /usr/local/nginx</span>
/usr/local/nginx
├── client_body_temp                 <span class="token comment"># POST 大文件暂存目录</span>
├── conf                             <span class="token comment"># Nginx所有配置文件的目录</span>
│   ├── fastcgi.conf                 <span class="token comment"># fastcgi相关参数的配置文件</span>
│   ├── fastcgi.conf.default         <span class="token comment"># fastcgi.conf的原始备份文件</span>
│   ├── fastcgi_params               <span class="token comment"># fastcgi的参数文件</span>
│   ├── fastcgi_params.default       
│   ├── koi-utf
│   ├── koi-win
│   ├── mime.types                   <span class="token comment"># 媒体类型</span>
│   ├── mime.types.default
│   ├── nginx.conf                   <span class="token comment">#这是Nginx默认的主配置文件，日常使用和修改的文件</span>
│   ├── nginx.conf.default
│   ├── scgi_params                  <span class="token comment"># scgi相关参数文件</span>
│   ├── scgi_params.default  
│   ├── uwsgi_params                 <span class="token comment"># uwsgi相关参数文件</span>
│   ├── uwsgi_params.default
│   └── win-utf
├── fastcgi_temp                     <span class="token comment"># fastcgi临时数据目录</span>
├── html                             <span class="token comment"># Nginx默认站点目录</span>
│   ├── 50x.html                     <span class="token comment"># 错误页面优雅替代显示文件，例如出现502错误时会调用此页面</span>
│   └── index.html                   <span class="token comment"># 默认的首页文件</span>
├── logs                             <span class="token comment"># Nginx日志目录</span>
│   ├── access.log                   <span class="token comment"># 访问日志文件</span>
│   ├── error.log                    <span class="token comment"># 错误日志文件</span>
│   └── nginx.pid                    <span class="token comment"># pid文件，Nginx进程启动后，会把所有进程的ID号写到此文件</span>
├── proxy_temp                       <span class="token comment"># 临时目录</span>
├── sbin                             <span class="token comment"># Nginx 可执行文件目录</span>
│   └── nginx                        <span class="token comment"># Nginx 二进制可执行程序</span>
├── scgi_temp                        <span class="token comment"># 临时目录</span>
└── uwsgi_temp                       <span class="token comment"># 临时目录</span>

</code></pre></div><h2 id="基本运行原理"><a href="#基本运行原理" class="header-anchor">#</a> 基本运行原理</h2> <p><strong>Nginx多进程模型和基本请求流程</strong></p> <p><img src="https://minboo-blog-img.oss-cn-guangzhou.aliyuncs.com/img/image-20220910171916479.png" alt="image-20220910171916479"></p> <p><strong>Nginx的进程是使用经典的「Master-Worker」模型，Nginx在启动后，会有一个master（主进程）进程和多个worker（子进程）进程，主进程用于协调子进程。</strong></p> <ul><li><p><strong>master</strong>进程主要用来管理worker进程，包含：接收来自外界的信号，向各worker进程发送信号，监控worker进程的运行状态，当worker进程退出后(异常情况下)，会自动重新启动新的worker进程。</p></li> <li><p><strong>worker</strong>进程主要处理基本的网络事件，多个worker进程之间是对等的，他们同等竞争来自客户端的请求，各进程互相之间是独立的。一个请求，只可能在一个worker进程中处理，一个worker进程，不可能处理其它进程的请求。worker进程的个数是可以设置的，一般会设置与机器cpu核数一致，这里面的原因与nginx的进程模型以及事件处理模型是分不开的。</p></li></ul> <h2 id="nginx配置"><a href="#nginx配置" class="header-anchor">#</a> Nginx配置</h2> <p>后面学习Nginx配置，每次修改配置文件，一定要重载才能生效</p> <div class="language-shell extra-class"><pre class="language-shell"><code>systemctl reload nginx
</code></pre></div><h3 id="简化版的nginx-conf"><a href="#简化版的nginx-conf" class="header-anchor">#</a> 简化版的nginx.conf</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>worker_processes  <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">#允许进程数量，建议设置为cpu核心数或者auto自动检测，注意Windows服务器上虽然可以启动多个processes，但是实际只会用其中一个</span>

events <span class="token punctuation">{</span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span> <span class="token comment"># 单个进程最大连接数（最大连接数=连接数*进程数）</span>
<span class="token punctuation">}</span>


http <span class="token punctuation">{</span>
    include       mime.types<span class="token punctuation">;</span> <span class="token comment">#include是引入关键字，这里引入了mime.types这个配置文件（同在conf目录下，mime.types是用来定义，请求返回的content-type）</span>
    default_type  application/octet-stream<span class="token punctuation">;</span> <span class="token comment">#mime.types未定义的，使用默认格式application/octet-stream</span>

    sendfile        on<span class="token punctuation">;</span> <span class="token comment">#sendfile指令指定nginx是否调用sendfile 函数（zero copy 方式）来输出文件，对于普通应用，必须设为on。如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘与网络IO处理速度。</span>
    
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span> <span class="token comment">#长连接超时时间，单位是秒</span>
 
 <span class="token comment">#一个nginx可以启用多个server（虚拟服务器）</span>
    server <span class="token punctuation">{</span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span><span class="token comment">#监听端口80</span>
        server_name  localhost<span class="token punctuation">;</span>  <span class="token comment">#接收的域名</span>

        location / <span class="token punctuation">{</span> 
            root   html<span class="token punctuation">;</span> <span class="token comment">#根目录指向html目录</span>
            index  index.html index.htm<span class="token punctuation">;</span> <span class="token comment">#域名/index 指向 index.html index.htm文件</span>
        <span class="token punctuation">}</span>

        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span> <span class="token comment"># 服务器错误码为500 502 503 504，转到&quot;域名/50x.html&quot;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span># 指定到html文件夹下找/50x.htm
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="最小配置"><a href="#最小配置" class="header-anchor">#</a> 最小配置</h3> <p><strong>worker_processes</strong></p> <p><code>worker_processes 1;</code>默认为1，表示开启一个业务进程</p> <p><strong>worker_connections</strong></p> <p><code>worker_connections 1024;</code>单个业务进程可接受连接数</p> <p><strong>include mime.types;</strong></p> <p><code>include mime.types;</code> 引入http mime类型</p> <p><strong>default_type application/octet-stream;</strong></p> <p><code>default_type application/octet-stream;</code> 如果mime类型没匹配上，默认使用二进制流的方式传输。</p> <p><strong>sendfile on;</strong></p> <p><code>sendfile on;</code> 使用linux的 sendfile(socket, file, len) 高效网络传输，也就是数据0拷贝。 未开启sendfile</p> <p><strong>sendfile</strong></p> <p>打开sendfile，用户请求的数据不用再加载到nginx的内存中，而是直接发送</p> <p><img src="https://minboo-blog-img.oss-cn-guangzhou.aliyuncs.com/img/image-20220502113913235.png" alt="image-20220502113913235"></p> <h3 id="nginx配置使用场景"><a href="#nginx配置使用场景" class="header-anchor">#</a> Nginx配置使用场景</h3> <p>修改nginx配置文件后，记得重新加载nginx</p> <div class="language-text extra-class"><pre class="language-text"><code>systemctl reload nginx
</code></pre></div><p><strong>不同二级域名，映射到不同静态网页</strong></p> <p>可以写多个server字段，从前向后匹配，先匹配到哪个就用哪个</p> <p>用户访问<code>aa.minboo.cn</code>，就会走到第一个server配置；<code>bb.minboo.cn</code>走到第二个配置</p> <div class="language-shell extra-class"><pre class="language-shell"><code> http <span class="token punctuation">{</span>
   <span class="token comment">#....其他属性</span>
   server <span class="token punctuation">{</span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  aa.minboo.cn<span class="token punctuation">;</span>

        location / <span class="token punctuation">{</span> 
            root   html/aa<span class="token punctuation">;</span> 
            index  index.html index.htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

   server <span class="token punctuation">{</span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  bb.minboo.cn<span class="token punctuation">;</span>

        location / <span class="token punctuation">{</span> 
            root   html/bb<span class="token punctuation">;</span> 
            index  index.html index.htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>不同域名，映射到同一静态页面</strong></p> <p><strong>server_name</strong></p> <ul><li>可以写多个，用空格分开</li> <li>使用通配符（*）</li> <li>使用正则表达式（<a href="https://blog.csdn.net/yangyelin/article/details/112976539" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/yangyelin/article/details/112976539<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>http<span class="token punctuation">{</span>   
   server <span class="token punctuation">{</span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  *.minboo.cn  ~^<span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span>+<span class="token punctuation">\</span>.minboo<span class="token punctuation">\</span>.cn$<span class="token punctuation">;</span> <span class="token comment"># &quot;\.&quot;是转译&quot;.&quot;</span>

        location / <span class="token punctuation">{</span> 
            root   html/aa<span class="token punctuation">;</span> 
            index  index.html index.htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="反向代理与负载均衡"><a href="#反向代理与负载均衡" class="header-anchor">#</a> 反向代理与负载均衡</h2> <p><strong>反向代理</strong>：这种代理方式叫做，隧道代理。有性能瓶颈，因为所有的数据都经过Nginx，所以Nginx服务器的性能至关重要</p> <p><img src="https://minboo-blog-img.oss-cn-guangzhou.aliyuncs.com/img/image-20220502173846436.png" alt="image-20220502173846436"></p> <p><strong>负载均衡</strong>：把请求，按照一定算法规则，分配给多台业务服务器（即使其中一个坏了/维护升级，还有其他服务器可以继续提供服务）</p> <p><img src="https://minboo-blog-img.oss-cn-guangzhou.aliyuncs.com/img/image-20220502174023144.png" alt="image-20220502174023144"></p> <h3 id="反向代理"><a href="#反向代理" class="header-anchor">#</a> 反向代理</h3> <h4 id="使用proyx-pass进行代理配置"><a href="#使用proyx-pass进行代理配置" class="header-anchor">#</a> 使用proyx_pass进行代理配置</h4> <p>启用proxy_pass，root和index字段就会失效</p> <p>proxy_pass后的地址必须写完整 <code>http://xxx</code>，不支持https</p> <p>当访问localhost时（Nginx服务器），网页打开的是<code>http://xxx</code>（应用服务器），网页地址栏写的还是localhost</p> <div class="language-shell extra-class"><pre class="language-shell"><code>http<span class="token punctuation">{</span>   
  server <span class="token punctuation">{</span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        location / <span class="token punctuation">{</span> 
         proxy_pass http://xxx<span class="token punctuation">;</span>
            <span class="token comment">#root   html/test; </span>
            <span class="token comment">#index  index.html index.htm;</span>
        <span class="token punctuation">}</span>

        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以把配置修改成如下，就会反向代理到百度</p> <div class="language-shell extra-class"><pre class="language-shell"><code>http<span class="token punctuation">{</span>   
  server <span class="token punctuation">{</span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        location / <span class="token punctuation">{</span> 
         proxy_pass http://baidu.com<span class="token punctuation">;</span>
            <span class="token comment">#root   html/test; </span>
            <span class="token comment">#index  index.html index.htm;</span>
        <span class="token punctuation">}</span>

        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="负载均衡"><a href="#负载均衡" class="header-anchor">#</a> 负载均衡</h3> <p><strong>【轮询模式】</strong></p> <p>使用<code>upstream</code>定义一组地址【在server字段下】 upstream后的别名可随意定义，但是proxy_pass处需要和此别名一致</p> <p>访问localhost，访问都会代理到<code>192.168.75.101:80</code>和<code>192.168.75.103:80</code>这两个地址之一，每次访问这两个地址轮着切换（后面讲到，因为默认权重相等）</p> <div class="language-shell extra-class"><pre class="language-shell"><code>http<span class="token punctuation">{</span>
 upstream httpds<span class="token punctuation">{</span> 
  server <span class="token number">192.168</span>.75.101:80<span class="token punctuation">;</span> <span class="token comment">#如果是80端口，可以省略不写</span>
  server <span class="token number">192.168</span>.75.103:80<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 server <span class="token punctuation">{</span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        location / <span class="token punctuation">{</span> 
         proxy_pass http://httpds<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="负载均衡策略"><a href="#负载均衡策略" class="header-anchor">#</a> 负载均衡策略</h4> <ul><li><p>轮询：默认算法按时间顺序逐一分配到不同的后端服务器;</p></li> <li><p>weight：权重</p></li> <li><p>down：当前server暂不参与负载均衡</p></li> <li><p>backup : 预留的备份服务器； 其它所有的非backup机器down或者忙的时候，请求backup机器</p></li> <li><p>ip_hash：为每一个请求访问的IP的hash结果分配，可以将来自一个IP的固定访问一个后端服务器</p></li> <li><p>url_hash：需要安装模块安装访问的URL的hash结果来分配，这样每个URL定向到同一个后端服务器</p></li> <li><p>least_conn：按照某台机器最少连接数的进行分配访问</p></li> <li><p>hash关键数值：hash 自定义 KEY</p></li></ul> <p><strong>【轮询</strong>】</p> <p>使用<code>upstream</code>定义一组地址【在server字段下】 upstream后的别名可随意定义，但是proxy_pass处需要和此别名一致</p> <p>访问localhost，访问都会代理到<code>192.168.75.101:80</code>和<code>192.168.75.103:80</code>这两个地址之一，每次访问这两个地址轮着切换（后面讲到，因为默认权重相等）</p> <div class="language-shell extra-class"><pre class="language-shell"><code>http<span class="token punctuation">{</span>
 upstream httpds<span class="token punctuation">{</span> 
  server <span class="token number">192.168</span>.75.101:80<span class="token punctuation">;</span> <span class="token comment">#如果是80端口，可以省略不写</span>
  server <span class="token number">192.168</span>.75.103:80<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 server <span class="token punctuation">{</span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        location / <span class="token punctuation">{</span> 
         proxy_pass http://httpds<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>weight：默认为1.weight越大，负载的权重就越大【权重模式】</strong></p> <p>访问使用哪个地址的权重，weigth的数值越高表示权重越高</p> <div class="language-text extra-class"><pre class="language-text"><code>upstream httpds{
    server 192.168.75.101:80 weight=10;
    server 192.168.75.103:80 weight=40;
    server 192.168.75.104:80 weight=80;
}
</code></pre></div><p><strong>down：表示当前的server暂时不参与负载</strong></p> <p>权重后面加down的表示不参与负载均衡，相当于下线</p> <div class="language-text extra-class"><pre class="language-text"><code>upstream httpds{
 server 192.168.75.101:80 weight=10;
 server 192.168.75.103:80 weight=40 down;
 server 192.168.75.104:80 weight=80;
}
</code></pre></div><p><strong>backup： 其它所有的非backup机器down或者忙的时候，请求backup机器</strong></p> <p>如果<code>192.168.75.104:80</code>出现故障，无法提供服务，就用使用backup的这个机器</p> <p>正常情况下不会使用<code>192.168.75.101</code>，只有当<code>192.168.75.104</code>发生故障时才会使用该服务器</p> <div class="language-text extra-class"><pre class="language-text"><code>upstream httpds{
 server 192.168.75.101:80 weight=10 backup;
 server 192.168.75.103:80 weight=40 down;
 server 192.168.75.104:80 weight=80;
}
</code></pre></div><h4 id="其他负载均衡策略-不常用"><a href="#其他负载均衡策略-不常用" class="header-anchor">#</a> 其他负载均衡策略（不常用）</h4> <p>【<strong>ip_hash</strong>】</p> <p>根据客户端的ip地址转发同一台服务器，可以保持会话</p> <p><strong>【least_conn】</strong></p> <p>最少连接访问</p> <p><strong>【url_hash】</strong></p> <p>根据用户访问的url定向转发请求</p> <p><strong>【fair】</strong></p> <p>根据后端服务器响应时间转发请求</p> <h2 id="动静分离"><a href="#动静分离" class="header-anchor">#</a> 动静分离</h2> <blockquote><p>为了提高网站的响应速度，减轻程序服务器（Tomcat，Jboss等）的负载，对于静态资源，如图片、js、css等文件，可以在反向代理服务器中进行缓存，这样浏览器在请求一个静态资源时，代理服务器就可以直接处理，而不用将请求转发给后端服务器。对于用户请求的动态文件，如servlet、jsp，则转发给Tomcat，Jboss服务器处理，这就是动静分离。即动态文件与静态文件的分离。</p></blockquote> <h3 id="动静分类原理"><a href="#动静分类原理" class="header-anchor">#</a> 动静分类原理</h3> <img src="https://minboo-blog-img.oss-cn-guangzhou.aliyuncs.com/img/1a28235590b24a13cef2173e4ce55c7a.webp" alt="img" style="zoom:50%;"> <p>动静分离可通过location对请求url进行匹配，将网站静态资源（HTML，JavaScript，CSS，img等文件）与后台应用分开部署，提高用户访问静态代码的速度，降低对后台应用访问。通常将静态资源放到nginx中，动态资源转发到tomcat服务器中。</p> <p><img src="https://minboo-blog-img.oss-cn-guangzhou.aliyuncs.com/img/1650505887062-47f2f7d3-d565-4184-9dee-5d8a2651ef53.png" alt="image.png"></p> <p><strong>例子：</strong></p> <ul><li>如果请求的资源地址是<code>location/</code>，<code>/</code>的优先级比较低，如果下面的location没匹配到，就会走<a href="http://192.168.75.104:8080" target="_blank" rel="noopener noreferrer">http://192.168.75.104:8080<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>这个地址的机器</li> <li>如果请求的资源地址是<code>location/css/*</code>，就会被匹配到nginx的html目录下的css文件夹中（我们把css静态资源放在这个位置）</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    server_name  localhost<span class="token punctuation">;</span>

    location / <span class="token punctuation">{</span> <span class="token comment"># /的优先级比较低，如果下面的location没匹配到，就会走http://xxx这个地址的机器</span>
     proxy_pass http://192.168.75.104:8080<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    location /css <span class="token punctuation">{</span>  <span class="token comment"># root指的是html，location/css指的是root下的css，所以地址就是html/css</span>
     root html<span class="token punctuation">;</span>
     index  index.html index.htm<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
     location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
     root   html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>使用正则</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>location ~*/<span class="token punctuation">(</span>js<span class="token operator">|</span>css<span class="token operator">|</span>img<span class="token punctuation">)</span><span class="token punctuation">{</span>
    root html<span class="token punctuation">;</span>
    index  index.html index.htm<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="location匹配顺序"><a href="#location匹配顺序" class="header-anchor">#</a> location匹配顺序</h3> <ul><li><p>多个正则location直接按书写顺序匹配，成功后就不会继续往后面匹配</p></li> <li><p>普通（非正则）location会一直往下，直到找到匹配度最高的（最大前缀匹配）</p></li> <li><p>当普通location与正则location同时存在，如果正则匹配成功,则不会再执行普通匹配</p></li> <li><p>所有类型location存在时，“=”匹配 &gt; “^~”匹配 &gt; 正则匹配 &gt; 普通（最大前缀匹配）</p></li></ul> <h2 id="url重写-urlrewrite"><a href="#url重写-urlrewrite" class="header-anchor">#</a> URL重写（URLRewrite）</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>rewrite是URL重写的关键指令，根据regex（正则表达式）部分内容，重定向到replacement，结尼是flag标记。

rewrite    <span class="token operator">&lt;</span>regex<span class="token operator">&gt;</span>   <span class="token operator">&lt;</span>replacement<span class="token operator">&gt;</span>  <span class="token punctuation">[</span>flag<span class="token punctuation">]</span><span class="token punctuation">;</span>
关键字    正则    替代内容     flagt标记

正则：per1森容正则表达式语句进行规则匹配
替代内容：将正则匹配的内容替换成replacement

flag标记说明：
last  <span class="token comment">#本条规则匹配完成后，继续向下匹配新的1ocation URI规则</span>
<span class="token builtin class-name">break</span> <span class="token comment">#本条规则匹配完成即终止，不再匹配后面的任何规则</span>

redirect <span class="token comment">#返回302临重定向，游览器地址会显示跳转后的URL地址</span>
permanent <span class="token comment">#返回301永久重定向，测览器地址栏会显示跳转后的URL地址</span>
</code></pre></div><p>浏览器地址栏访问 <code>xxx/123.html</code>实际上是访问<code>xxx/index.jsp?pageNum=123</code></p> <div class="language-shell extra-class"><pre class="language-shell"><code>server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
     server_name  localhost<span class="token punctuation">;</span>

    location / <span class="token punctuation">{</span>
     // URL重写
     rewrite ^/<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span>+<span class="token punctuation">)</span>.html$ /index.jsp?pageNum<span class="token operator">=</span><span class="token variable">$1</span>  <span class="token builtin class-name">break</span><span class="token punctuation">;</span>
     proxy_pass http://xxx<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
     location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
     root   html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="负载均衡-urlrewirte"><a href="#负载均衡-urlrewirte" class="header-anchor">#</a> 负载均衡+URLRewirte</h2> <p><img src="https://minboo-blog-img.oss-cn-guangzhou.aliyuncs.com/img/image-20220503121135171.png" alt="image-20220503121135171"></p> <p>上图中，应用服务器，不能直接被外网访问到，只能通过Nginx服务器进行访问（使用proxy_pass），这时候这台Nginx服务器就成为了网关服务器（承担入口的功能）</p> <p>所以，我们启动应用服务器的防火墙，设置其只能接受这台Nginx服务器的请求</p> <p>此前我们从<code>192.168.75.101</code>Nginx服务器反向代理到<code>192.168.75.104</code>Tomcat服务器</p> <p><strong>开启被反向代理服务器防火墙</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>systemctl start firewalld
</code></pre></div><p><strong>重载规则</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>firewall-cmd <span class="token parameter variable">--reload</span>
</code></pre></div><p><strong>查看已配置规则</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>firewall-cmd --list-all
</code></pre></div><p><strong>添加rich规则，添加指定端口和ip访问</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>firewall-cmd <span class="token parameter variable">--permanent</span> --add-rich-rule<span class="token operator">=</span><span class="token string">&quot;rule family=&quot;</span>ipv4<span class="token string">&quot; source address=&quot;</span><span class="token number">192.168</span>.75.101<span class="token string">&quot; port protocol=&quot;</span>tcp<span class="token string">&quot; port=&quot;</span><span class="token number">8080</span><span class="token string">&quot; accept&quot;</span> <span class="token comment">#添加指定端口和ip访问，此条命令表示允许192.168.75.101访问当前服务器的8080端口</span>
</code></pre></div><p><strong>移除rich规则</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>firewall-cmd <span class="token parameter variable">--permanent</span> --remove-rich-rule<span class="token operator">=</span><span class="token string">&quot;rule family=&quot;</span>ipv4<span class="token string">&quot; source address=&quot;</span><span class="token number">192.168</span>.75.101<span class="token string">&quot; port port=&quot;</span><span class="token number">8080</span><span class="token string">&quot; protocol=&quot;</span>tcp<span class="token string">&quot; accept&quot;</span>
</code></pre></div><p><strong>重启</strong></p> <p>移除和添加规则都要重启才能生效</p> <div class="language-shell extra-class"><pre class="language-shell"><code>firewall-cmd <span class="token parameter variable">--reload</span>
</code></pre></div><p><strong>查看所有规则</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>firewall-cmd --list-all <span class="token comment">#所有开启的规则</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/minboo/docs/edit/master/docs/Middleware/Nginx/README.md" target="_blank" rel="noopener noreferrer">编辑文档！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">9/13/2022, 12:35:27 AM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/Middleware/Nginx/configuration.html">
        Nginx配置
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.9f94fa3e.js" defer></script><script src="/assets/js/2.8154945c.js" defer></script><script src="/assets/js/12.f4be0313.js" defer></script><script src="/assets/js/3.4234061e.js" defer></script>
  </body>
</html>
